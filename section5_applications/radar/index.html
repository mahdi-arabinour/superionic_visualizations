<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>D3 Radar Chart (Clean with Values, No Overlaps)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: #f8fafc;
      color: #111827;
    }
    .container {
      max-width: 1000px;
      margin: 30px auto;
      padding: 0 20px;
    }
    h1 {
      font-size: 22px;
      margin-bottom: 16px;
    }
    .card {
      display: grid;
      grid-template-columns: 1fr 220px;
      gap: 24px;
      background: #fff;
      border-radius: 14px;
      padding: 18px;
      box-shadow: 0 6px 25px rgba(0,0,0,0.06);
    }
    #legend .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 13px;
    }
    .legend-swatch {
      width: 14px;
      height: 14px;
      border-radius: 3px;
      display: inline-block;
    }
    .gridCircle {
      fill: none;
      stroke: #e5e7eb;
    }
    .axis line {
      stroke: #9ca3af;
      stroke-width: 1;
    }
    .axisLabel {
      fill: #374151;
      font-size: 12px;
      font-weight: 500;
    }
    .value-label {
      font-size: 11px;
      fill: #111827;
      paint-order: stroke;
      stroke: white;
      stroke-width: 3px;
      stroke-linejoin: round;
    }
    .levelLabel {
      font-size: 10px;
      fill: #6b7280;
    }
    .tooltip {
      position: absolute;
      pointer-events: none;
      background: rgba(17,24,39,.95);
      color: white;
      padding: 6px 8px;
      border-radius: 6px;
      font-size: 12px;
      line-height: 1.2;
      opacity: 0;
      transform: translate(-50%, -120%);
      white-space: nowrap;
    }
    @media (max-width: 900px) {
      .card { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Radar Chart</h1>
    <div class="card">
      <svg id="radarChart" width="860" height="640" role="img" aria-label="Radar chart"></svg>
      <div id="legend"></div>
    </div>
  </div>

  <div id="tooltip" class="tooltip" aria-hidden="true"></div>

  <script>
    const CSV_PATH = "data.csv";
    const svg = d3.select("#radarChart");
    const legendEl = d3.select("#legend");
    const tooltip = d3.select("#tooltip");

    const width = +svg.attr("width");
    const height = +svg.attr("height");
    const margin = { top: 60, right: 60, bottom: 60, left: 60 };
    const cx = width / 2, cy = height / 2;
    const radius = Math.min(width, height) / 2 - Math.max(margin.left, margin.top);
    const levels = 5;

    d3.csv(CSV_PATH).then(data => {
      const cols = data.columns ?? Object.keys(data[0]);
      const groupKey = cols[0];
      const categories = cols.slice(1);

      data.forEach(row => categories.forEach(c => row[c] = +row[c]));

      const allVals = data.flatMap(d => categories.map(c => +d[c]));
      const maxVal = d3.max(allVals);
      const rScale = d3.scaleLinear().domain([0, maxVal]).range([0, radius]);
      const angleSlice = (Math.PI * 2) / categories.length;
      const color = d3.scaleOrdinal(d3.schemeTableau10);
      const fmt = d3.format(",.2~f");

      // Grid circles
      const grid = svg.append("g");
      for (let i = 1; i <= levels; i++) {
        grid.append("circle")
          .attr("class", "gridCircle")
          .attr("cx", cx)
          .attr("cy", cy)
          .attr("r", (radius / levels) * i);
      }

      // Move level labels away from data region
      for (let i = 1; i <= levels; i++) {
        grid.append("text")
          .attr("class", "levelLabel")
          .attr("x", cx - radius - 45)  // move left
          .attr("y", cy - (radius / levels) * i + 4) // slight vertical shift
          .attr("text-anchor", "start")
          .text(d3.format(".2~s")((maxVal / levels) * i));
      }

      // Axes
      const axis = svg.append("g").attr("class", "axis");
      const labelOffset = 45; // far enough from chart
      categories.forEach((cat, i) => {
        const angle = angleSlice * i - Math.PI / 2;
        const x = cx + Math.cos(angle) * radius;
        const y = cy + Math.sin(angle) * radius;

        axis.append("line")
          .attr("x1", cx).attr("y1", cy)
          .attr("x2", x).attr("y2", y);

        const lx = cx + Math.cos(angle) * (radius + labelOffset);
        const ly = cy + Math.sin(angle) * (radius + labelOffset);

        axis.append("text")
          .attr("class", "axisLabel")
          .attr("x", lx)
          .attr("y", ly)
          .attr("text-anchor",
            Math.abs(Math.cos(angle)) < 0.35 ? "middle" :
            (Math.cos(angle) > 0 ? "start" : "end"))
          .attr("dy",
            Math.abs(Math.sin(angle)) < 0.35 ? "0.35em" :
            (Math.sin(angle) > 0 ? "0.9em" : "-0.4em"))
          .text(cat);
      });

      const line = d3.lineRadial()
        .radius(d => rScale(d.value))
        .angle((d, i) => i * angleSlice)
        .curve(d3.curveLinearClosed);

      function showTooltip(event, html) {
        tooltip.style("left", event.pageX + "px")
               .style("top", (event.pageY - 10) + "px")
               .style("opacity", 1)
               .attr("aria-hidden", "false")
               .html(html);
      }
      function hideTooltip() {
        tooltip.style("opacity", 0).attr("aria-hidden", "true");
      }

      data.forEach((row, i) => {
        const series = categories.map((c, j) => ({
          axis: c,
          value: +row[c],
          angle: j * angleSlice
        }));

        svg.append("path")
          .datum(series)
          .attr("transform", `translate(${cx},${cy})`)
          .attr("fill", color(i))
          .attr("fill-opacity", 0.18)
          .attr("stroke", color(i))
          .attr("stroke-width", 2)
          .attr("d", line);

        const g = svg.append("g").attr("transform", `translate(${cx},${cy})`);

        g.selectAll("circle.point")
          .data(series)
          .enter()
          .append("circle")
          .attr("r", 3.5)
          .attr("cx", d => Math.cos(d.angle - Math.PI/2) * rScale(d.value))
          .attr("cy", d => Math.sin(d.angle - Math.PI/2) * rScale(d.value))
          .attr("fill", color(i))
          .on("mousemove", (event, d) => {
            showTooltip(event, `<strong>${row[groupKey]}</strong><br/>${d.axis}: ${fmt(d.value)}`);
          })
          .on("mouseleave", hideTooltip);

        g.selectAll("text.value-label")
          .data(series)
          .enter()
          .append("text")
          .attr("class", "value-label")
          .attr("x", d => Math.cos(d.angle - Math.PI/2) * rScale(d.value))
          .attr("y", d => Math.sin(d.angle - Math.PI/2) * rScale(d.value))
          .attr("dx", d => Math.cos(d.angle - Math.PI/2) * 14)
          .attr("dy", d => Math.sin(d.angle - Math.PI/2) * 14)
          .attr("text-anchor", d => {
            const a = Math.cos(d.angle - Math.PI/2);
            if (Math.abs(a) < 0.35) return "middle";
            return a > 0 ? "start" : "end";
          })
          .text(d => fmt(d.value));
      });

      // Legend
      data.forEach((row, i) => {
        const item = legendEl.append("div").attr("class", "legend-item");
        item.append("span").attr("class", "legend-swatch").style("background", color(i));
        item.append("span").text(row[groupKey]);
      });
    });
  </script>
</body>
</html>
