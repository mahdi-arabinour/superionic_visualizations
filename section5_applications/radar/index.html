<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Radar Chart with D3.js</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #fafafa;
    }
    .axisLabel {
      font-size: 12px;
      fill: #333;
    }
    .legend {
      font-size: 13px;
    }
    .gridCircle {
      fill: none;
      stroke: #CDCDCD;
      stroke-opacity: 0.5;
    }
  </style>
</head>
<body>
  <svg id="radarChart" width="800" height="600"></svg>

  <script>
    const width = 800, height = 600;
    const margin = {top: 80, right: 150, bottom: 60, left: 100};
    const levels = 5; // number of concentric circles
    const maxValue = 1.0; // adjust or compute dynamically
    const svg = d3.select("#radarChart")
      .attr("width", width)
      .attr("height", height);

    const radius = Math.min(width / 2, height / 2) - 100;
    const centerX = width / 2;
    const centerY = height / 2;

    d3.csv("data.csv").then(data => {
      const categories = data.columns.slice(1); // assume first col = group name
      const angleSlice = (Math.PI * 2) / categories.length;

      const maxVal = d3.max(data, d => d3.max(categories, c => +d[c]));
      const rScale = d3.scaleLinear().domain([0, maxVal]).range([0, radius]);

      // Draw concentric circles
      for (let i = 0; i <= levels; i++) {
        const levelFactor = radius * (i / levels);
        svg.append("circle")
          .attr("class", "gridCircle")
          .attr("cx", centerX)
          .attr("cy", centerY)
          .attr("r", levelFactor);
      }

      // Axis lines and labels
      categories.forEach((cat, i) => {
        const angle = angleSlice * i - Math.PI / 2;
        const x = centerX + Math.cos(angle) * radius;
        const y = centerY + Math.sin(angle) * radius;

        svg.append("line")
          .attr("x1", centerX)
          .attr("y1", centerY)
          .attr("x2", x)
          .attr("y2", y)
          .attr("stroke", "#999");

        svg.append("text")
          .attr("class", "axisLabel")
          .attr("x", x)
          .attr("y", y)
          .attr("dy", "0.35em")
          .attr("text-anchor", "middle")
          .text(cat);
      });

      const color = d3.scaleOrdinal(d3.schemeTableau10);

      // Draw radar areas
      const line = d3.lineRadial()
        .radius(d => rScale(d.value))
        .angle((d, i) => i * angleSlice)
        .curve(d3.curveLinearClosed);

      data.forEach((d, i) => {
        const values = categories.map(c => ({axis: c, value: +d[c]}));

        svg.append("path")
          .datum(values)
          .attr("transform", `translate(${centerX},${centerY})`)
          .attr("fill", color(i))
          .attr("fill-opacity", 0.2)
          .attr("stroke", color(i))
          .attr("stroke-width", 2)
          .attr("d", line);

        // Add legend
        svg.append("rect")
          .attr("x", width - margin.right + 10)
          .attr("y", margin.top + i * 25)
          .attr("width", 15)
          .attr("height", 15)
          .attr("fill", color(i));

        svg.append("text")
          .attr("class", "legend")
          .attr("x", width - margin.right + 30)
          .attr("y", margin.top + 12 + i * 25)
          .text(d[data.columns[0]]);
      });
    });
  </script>
</body>
</html>
