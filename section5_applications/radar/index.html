<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Radar Chart — Clean with Colored Axes & Percent Grid</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
  body{margin:0;background:#fff;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  #chart{width:100vw;height:100vh}
  svg{width:100%;height:100%}
  .gridCircle{fill:none;stroke:#cfcfcf;stroke-dasharray:3 3}
  .spoke{stroke:#d6d6d6}
  .gridLabel{font-size:10px;fill:#7a7a7a;text-anchor:start;}
  .axisTitle{
    font-size:12px;
    font-weight:700;
    text-anchor:middle;
  }
  .valueLabel{
    font-size:11px;
    font-weight:700;
    paint-order:stroke fill;
    stroke:#fff;stroke-width:3px;
  }
</style>
</head>
<body>
<div id="chart"></div>
<script>
// --- AXES CONFIG ---
const axes = [
  { key: "log_cond_norm",  label: "log₁₀(σ)", color: "#1f77b4" },
  { key: "inv_Ea_norm",    label: "1/Ea", color: "#ff7f0e" },
  { key: "cycle_norm",     label: "log₁₀(N)", color: "#2ca02c" },
  { key: "ret_norm",       label: "Retention %", color: "#d62728" },
  { key: "simplicity",     label: "Synthesis Simplicity", color: "#9467bd" }
];

const palette = d3.schemeTableau10.concat(["#a6cee3","#b2df8a","#fb9a99","#fdbf6f","#cab2d6","#ffff99"]);
const LABEL_PAD = 12;

d3.csv("radar_ready.csv").then(raw => {
  const data = raw.map(d => ({
    Structure_Type: (d.Structure_Type||"").trim(),
    log_cond_norm:  +d.log_cond_norm,
    inv_Ea_norm:    +d.inv_Ea_norm,
    cycle_norm:     +d.cycle_norm,
    ret_norm:       +d.ret_norm,
    simplicity:     +d.simplicity
  })).filter(d => d.Structure_Type);
  draw(data);
});

function draw(data){
  const chartDiv = d3.select("#chart");
  const W = chartDiv.node().clientWidth;
  const H = chartDiv.node().clientHeight;

  const svg = chartDiv.append("svg").attr("viewBox",`0 0 ${W} ${H}`);
  const g = svg.append("g").attr("transform",`translate(${W/2},${H/2})`);

  const radius = Math.min(W,H)*0.4;
  const rScale = d3.scaleLinear().domain([0,1]).range([0,radius]);
  const angle = i => (Math.PI*2*i/axes.length) - Math.PI/2;
  const color = d3.scaleOrdinal().domain(data.map(d=>d.Structure_Type)).range(palette);

  // --- GRID RINGS ---
  const levels = [0.25,0.5,0.75,1];
  g.append("g")
    .selectAll("circle")
    .data(levels)
    .join("circle")
      .attr("class","gridCircle")
      .attr("r",d=>rScale(d));

  // --- SPOKES ---
  g.append("g")
    .selectAll("line")
    .data(axes)
    .join("line")
      .attr("class","spoke")
      .attr("x1",0).attr("y1",0)
      .attr("x2",(d,i)=>Math.cos(angle(i))*radius)
      .attr("y2",(d,i)=>Math.sin(angle(i))*radius);

  // --- GRID LABELS AS PERCENTAGES ---
  g.append("g")
    .selectAll("text")
    .data(levels)
    .join("text")
      .attr("class","gridLabel")
      .attr("x",rScale(1)+8)
      .attr("y",d=>-rScale(d))
      .text(d=>d3.format(".0%")(d));

  // --- AXIS TITLES (COLORED) ---
  g.append("g").selectAll("text.axisTitle")
    .data(axes)
    .join("text")
      .attr("class","axisTitle")
      .attr("x",(d,i)=>Math.cos(angle(i))*(radius+18))
      .attr("y",(d,i)=>Math.sin(angle(i))*(radius+18))
      .attr("fill",d=>d.color)
      .text(d=>d.label);

  // --- POLYGONS ---
  const line = d3.lineRadial()
      .radius(d=>rScale(d.value))
      .angle(d=>angle(d.index))
      .curve(d3.curveLinearClosed);

  g.append("g")
    .selectAll("path")
    .data(data.map(s => ({
      key: s.Structure_Type,
      values: axes.map((ax,i)=>({ index:i, value:+s[ax.key] }))
    })))
    .join("path")
      .attr("d", d => line(d.values))
      .attr("fill", d => color(d.key))
      .attr("stroke", d => d3.color(color(d.key)).darker(0.6))
      .attr("stroke-width", 1.5)
      .attr("fill-opacity", 0.4);

  // --- VALUE LABELS ---
  const labelsG = g.append("g");
  data.forEach(s => {
    const c = color(s.Structure_Type);
    axes.forEach((ax,i)=>{
      const val = +s[ax.key];
      if (!Number.isFinite(val)) return;
      const r = rScale(val) + LABEL_PAD;
      const ang = angle(i);
      const x = Math.cos(ang)*r;
      const y = Math.sin(ang)*r;
      const cos = Math.cos(ang);
      const anchor = cos>0.2 ? "start" : (cos<-0.2 ? "end" : "middle");
      labelsG.append("text")
        .attr("class","valueLabel")
        .attr("x",x).attr("y",y)
        .attr("text-anchor",anchor)
        .attr("fill",c)
        .text(d3.format(".2f")(val));
    });
  });
}
</script>
</body>
</html>
